<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>My Tasks — Task Manager</title>
  <style>
    :root{
      --bg1:#6a11cb; --bg2:#2575fc; --accent:#00b894;
      --card-shadow: 0 16px 40px rgba(6,12,40,0.24);
      --muted: rgba(255,255,255,0.92);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff;
      min-height:100vh;
      background-size:400% 400%;
      animation:floatingBg 18s infinite alternate linear;
      -webkit-font-smoothing:antialiased;
    }
    @keyframes floatingBg { from{background-position:0 0} to{background-position:100% 100%} }

    /* NAV */
    .navbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 20px; background: rgba(0,0,0,0.22); backdrop-filter: blur(6px);
      position:relative; z-index:1000;
    }
    .brand{ font-weight:700; font-size:1.05rem; letter-spacing:0.6px; }
    .menu-icon{ display:flex; flex-direction:column; gap:5px; cursor:pointer; padding:8px; z-index:1100; }
    .menu-icon div{ width:28px; height:3.6px; background:rgba(255,255,255,0.96); border-radius:3px; transition: transform .18s, opacity .18s; }

    .menu{
      position:absolute; right:20px; top:calc(100% + 12px);
      width:220px; background: linear-gradient(180deg, rgba(6,10,30,0.98), rgba(10,16,40,0.98));
      border-radius:12px; padding:8px; box-shadow:var(--card-shadow);
      transform-origin: top right; transform: translateY(-6px) scale(.98); opacity:0; pointer-events:none;
      transition: opacity .22s ease, transform .22s cubic-bezier(.2,.9,.2,1); z-index:1200;
    }
    .menu.open{ transform: translateY(0) scale(1); opacity:1; pointer-events:auto; }
    .menu a{ color:var(--muted); text-decoration:none; padding:10px 12px; font-weight:600; border-radius:8px; margin:4px; display:block; }
    .menu a:hover{ background: rgba(255,255,255,0.03); transform: translateX(4px); transition: transform .12s, background .12s; }

    .menu-icon.open > div:nth-child(1){ transform: translateY(6px) rotate(45deg); }
    .menu-icon.open > div:nth-child(2){ opacity: 0; transform: scaleX(0); }
    .menu-icon.open > div:nth-child(3){ transform: translateY(-6px) rotate(-45deg); }

    header{ text-align:center; padding:36px 18px 8px; }
    header h1{ margin:0; font-size:2.0rem; letter-spacing:0.6px; text-shadow:0 6px 30px rgba(0,0,0,0.25); }
    header p{ margin-top:8px; opacity:0.92; font-weight:600; }

    .wrap{ width:92%; max-width:1100px; margin:20px auto 80px; display:grid; grid-template-columns: 1fr 320px; gap:28px; align-items:start; }
    @media (max-width:980px){ .wrap{ grid-template-columns:1fr; } }

    /* tasks panel */
    .tasks-panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      padding:18px; border-radius:var(--radius); box-shadow:var(--card-shadow);
    }
    .panel-title{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
    .panel-title h2{ margin:0; font-size:1.1rem; }

    /* FILTER ROW - kept */
    .filter-row{ display:flex; gap:14px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .filter-row label{ font-weight:700; color:var(--muted); margin-right:6px; }
    .filter-row select{ padding:8px 10px; border-radius:8px; border:none; background:#fff; color:#222; font-weight:700 }

    /* tasks list */
    .tasks{ display:grid; gap:12px; }
    .task-card{ background: rgba(255,255,255,0.06); border-radius:12px; padding:14px; box-shadow:0 12px 28px rgba(3,12,30,0.18); transition: transform .22s, box-shadow .22s; }
    .task-card:hover{ transform:translateY(-6px); box-shadow:0 22px 44px rgba(6,12,40,0.28); }
    .task-head{ display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }
    .task-title{ font-size:1.02rem; font-weight:700; margin:0; color:#fff; }
    .task-desc{ margin:8px 0 0 0; color:#dfe6e9; opacity:0.95; }
    .task-meta{ color:#dfe6e9; font-size:0.9rem; margin-top:10px; }
    .task-actions{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; justify-content:flex-end; }

    .btn{ padding:8px 10px; border-radius:8px; border:none; font-weight:700; cursor:pointer; }
    .btn-toggle{ background:#ffd166; color:#111; }
    .btn-delete{ background:#ff6b6b; color:#fff; }

    /* right column */
    .side-panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      padding:18px; border-radius:var(--radius); box-shadow:var(--card-shadow); height:fit-content;
    }
    .avatar{
      width:84px; height:84px; border-radius:50%; overflow:hidden; display:flex; align-items:center; justify-content:center; margin-bottom:12px;
      background:linear-gradient(135deg,#fff6,#fff4); color:#222; font-weight:800;
    }
    .summary{ display:grid; gap:10px; margin-top:12px; }
    .summary .row{ display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; background: rgba(255,255,255,0.02); }
    .summary .row b{ font-size:1rem; }

    footer{ text-align:center; margin-top:30px; padding:18px; font-size:14px; color:rgba(255,255,255,0.9); }

    @media (max-width:600px){
      .task-head{ flex-direction:column; align-items:flex-start; gap:6px; }
    }
    /* NAVBAR - robust mobile-friendly layout */
/* NAVBAR - robust mobile-friendly layout */
.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: rgba(0,0,0,0.18);
  backdrop-filter: blur(6px);
  position: relative;
  z-index: 1200;
}

/* left group: logo + text */
.navbar-left {
  display:flex;
  align-items:center;
  gap:12px;
  min-width: 0; /* allow children to shrink safely */
}

/* logo image */
.brand-logo {
  width:40px;
  height:40px;
  border-radius:8px;
  object-fit:cover;
  flex: 0 0 auto;
  box-shadow: 0 6px 14px rgba(0,0,0,0.28);
}

/* text next to logo – truncate if not enough width */
.brand-text {
  font-weight:700;
  font-size:1.05rem;
  color:#fff;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  flex: 1 1 auto; /* can shrink if necessary */
  min-width:0; /* IMPORTANT for preventing overflow/clipping on Android */
}

/* right group: menu icon */
.navbar-right {
  display:flex;
  align-items:center;
  gap:12px;
  flex: 0 0 auto;
}

/* menu icon */
.menu-icon {
  display:flex;
  flex-direction:column;
  gap:6px;
  cursor:pointer;
  padding:8px;
  background: rgba(255,255,255,0.92);
  border-radius:10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  -webkit-tap-highlight-color: transparent;
  z-index:1300;
}

.menu-icon div { width:28px; height:3.6px; background:rgba(10,14,20,0.96); border-radius:3px; }

/* responsive tweaks */
@media (max-width:420px) {
  .brand-text { font-size: 0.96rem; }   /* slightly smaller on small phones */
  .brand-logo { width:36px; height:36px; }
}
/* hide text only on extremely narrow screens if necessary */
@media (max-width:320px) {
  .brand-text { display:none; }
}


  </style>
</head>
<body>
  <!-- REPLACE the old navbar block with this -->
<div class="navbar" role="navigation" aria-label="Main navigation">
  <div class="navbar-left">
    <img src="/static/images/logo.png" alt="Task Manager logo" class="brand-logo" />
    <div class="brand-text">Task Manager</div>
  </div>

  <div class="navbar-right">
    <div id="menuIcon" class="menu-icon" aria-label="menu" title="menu">
      <div></div><div></div><div></div>
    </div>
    <nav id="menu" class="menu" aria-hidden="true">
      <a href="/dashboard">Home</a>
      <a href="/mytask">My Tasks</a>
      <a href="/profile">Profile</a>
      <a href="/about">About</a>
      <a href="/logout" style="color:#ff6b6b;">Logout</a>
    </nav>
  </div>
</div>



  <header>
    <h1>My Tasks</h1>
    <p>Your personal task list — only tasks that belong to you are shown here.</p>
  </header>

  <main class="wrap">
    <!-- LEFT: Tasks panel -->
    <section class="tasks-panel" aria-label="tasks-list">
      <div class="panel-title">
        <h2>Tasks</h2>
        <div style="opacity:0.9; font-weight:700;">(<span id="totalCount">0</span>)</div>
      </div>

      <!-- FILTER ROW (kept) -->
      <div class="filter-row">
        <div>
          <label for="statusFilter">Status</label>
          <select id="statusFilter" aria-label="Filter by status">
            <option value="All">All</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
          </select>
        </div>

        <div>
          <label for="priorityFilter">Priority</label>
          <select id="priorityFilter" aria-label="Filter by priority">
            <option value="All">All</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
          </select>
        </div>
      </div>

      <!-- TASK LIST -->
      <section id="tasksContainer" class="tasks" aria-live="polite"></section>
    </section>

    <!-- RIGHT: summary & profile -->
    <aside class="side-panel" aria-label="summary-and-profile">
      <div style="display:flex; align-items:center; gap:12px;">
        <div class="avatar">
  {% if avatar %}
    <img src="{{ url_for('static', filename='uploads/avatars/' + avatar) }}"
         alt="avatar"
         style="width:100%;height:100%;object-fit:cover;">
  {% else %}
    <span style="font-size:1.8rem;">
      {{ (username[:1] if username) or 'U' }}
    </span>
  {% endif %}
</div>
<div>
  <div style="font-weight:800; font-size:1.05rem;">{{ username or 'User' }}</div>
  <div style="opacity:0.9; font-size:0.92rem;">Member</div>
</div>

      </div>

      <div class="summary" style="margin-top:16px;">
        <div class="row"><div>Pending</div><div><b id="pendingCount">0</b></div></div>
        <div class="row"><div>In Progress</div><div><b id="progressCount">0</b></div></div>
        <div class="row"><div>Completed</div><div><b id="completedCount">0</b></div></div>
      </div>

      <div style="margin-top:12px; font-size:0.92rem; color:var(--muted);">Tip: use the buttons on each task to quickly update status or delete tasks.</div>
    </aside>
  </main>

  <footer>
    © 2025 Task Manager | Plan smart, work smarter.
  </footer>

<script>
  /* MENU */
  const menu = document.getElementById('menu'), menuIcon = document.getElementById('menuIcon');
  function openMenu(){ menu.classList.add('open'); menuIcon.classList.add('open'); menu.setAttribute('aria-hidden','false'); }
  function closeMenu(){ menu.classList.remove('open'); menuIcon.classList.remove('open'); menu.setAttribute('aria-hidden','true'); }
  menuIcon.addEventListener('click', e => { e.stopPropagation(); if(menu.classList.contains('open')) closeMenu(); else openMenu(); });
  document.addEventListener('click', (e)=>{ if(!menu.contains(e.target) && !menuIcon.contains(e.target)) closeMenu(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });
  document.querySelectorAll('#menu a').forEach(a=>a.addEventListener('click', ()=> closeMenu()));

  /* TASKS: integrate with same backend endpoints */
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('statusFilter').addEventListener('change', loadTasks);
    document.getElementById('priorityFilter').addEventListener('change', loadTasks);
    loadTasks();
  });

  async function loadTasks(){
    try{
      const res = await fetch('/get_tasks');
      if(!res.ok){ console.error('get_tasks failed', await res.text()); document.getElementById('tasksContainer').innerHTML = '<div class="task-card">Unable to load tasks (see console).</div>'; return; }
      const tasks = await res.json();
      renderTasks(tasks);
      updateSummary(tasks);
    } catch(err){ console.error('loadTasks error', err); document.getElementById('tasksContainer').innerHTML = '<div class="task-card">Error loading tasks (see console).</div>'; }
  }

  function updateSummary(tasks){
    const pending = tasks.filter(t=>t.status==='Pending').length;
    const progress = tasks.filter(t=>t.status==='In Progress').length;
    const completed = tasks.filter(t=>t.status==='Completed').length;
    document.getElementById('pendingCount').textContent = pending;
    document.getElementById('progressCount').textContent = progress;
    document.getElementById('completedCount').textContent = completed;
    document.getElementById('totalCount').textContent = tasks.length;
  }

  function renderTasks(tasks){
    const container = document.getElementById('tasksContainer'); container.innerHTML = '';
    const statusFilter = document.getElementById('statusFilter').value;
    const priorityFilter = document.getElementById('priorityFilter').value;
    let list = (tasks||[]).slice();
    if(statusFilter !== 'All') list = list.filter(t => t.status === statusFilter);
    if(priorityFilter !== 'All') list = list.filter(t => t.priority === priorityFilter);

    if(list.length === 0){
      container.innerHTML = '<div class="task-card">No tasks to show.</div>'; return;
    }

    list.forEach((task,i) => {
      const card = document.createElement('article');
      card.className = 'task-card';
      card.innerHTML = `
        <div class="task-head">
          <div style="flex:1">
            <p class="task-title">${escapeHtml(task.title)}</p>
            ${task.description ? `<p class="task-desc">${escapeHtml(task.description)}</p>` : ''}
            <div class="task-meta">${escapeHtml(task.priority||'Medium')} • ${task.due_date ? 'Due: ' + escapeHtml(task.due_date) : 'No due date'} • ${escapeHtml(task.status)}</div>
            <div class="task-actions" style="margin-top:10px;">
              <button class="btn btn-toggle">${task.status==='Completed' ? 'Mark Pending' : (task.status==='Pending' ? 'Start Progress' : 'Mark Completed')}</button>
              <button class="btn btn-delete">Delete</button>
            </div>
          </div>
        </div>
      `;
      // toggle
      card.querySelector('.btn-toggle').addEventListener('click', async () => {
        try{
          const r = await fetch('/toggle_task/' + task.id, { method:'POST' });
          if(!r.ok){ console.error('toggle failed', await r.text()); return; }
          loadTasks();
        }catch(e){ console.error(e); }
      });

      // delete
      card.querySelector('.btn-delete').addEventListener('click', async () => {
        if(!confirm('Delete this task?')) return;
        try{
          const r = await fetch('/delete_task/' + task.id, { method:'DELETE' });
          if(!r.ok){ console.error('delete failed', await r.text()); return; }
          loadTasks();
        }catch(e){ console.error(e); }
      });

      container.appendChild(card);
    });
  }

  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
</script>
</body>
</html>
