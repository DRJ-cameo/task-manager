<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Reset Password — Task Management Tool</title>

<style>
  :root{
    --bg1:#071029; --bg2:#0b1630; --accent:#06b981; --muted:#94a3b8;
    --card-radius:14px; --toast-ttl:5200;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    -webkit-font-smoothing:antialiased; background: linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#fff; display:flex; align-items:center; justify-content:center; overflow:hidden;
  }

  /* background + grain (same as forgot/login) */
  .bg-layer{ position:fixed; inset:0; z-index:-2; overflow:hidden; pointer-events:none; }
  .bg-layer img{ width:120%; height:120%; object-fit:cover; filter:brightness(.6) saturate(.95); transform-origin:center;
    animation:slowFloat 22s ease-in-out infinite alternate; }
  @keyframes slowFloat{ from{ transform:translateY(0) scale(1) } to{ transform:translateY(-30px) scale(1.05) } }
  .grain{ position:fixed; inset:0; background-image:radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px); background-size:6px 6px; opacity:0.35; z-index:-1; pointer-events:none; }

  /* panel */
  .panel{
    width:400px;
    max-width:92vw;
    padding:28px;
    border-radius:16px;
    background: rgba(255,255,255,0.03);
    backdrop-filter: blur(10px);
    box-shadow:0 24px 60px rgba(2,6,23,0.62);
    animation:fadePop .5s ease;
  }
  @keyframes fadePop{ from{ opacity:0; transform:translateY(12px) scale(.98) } to{ opacity:1; transform:none } }

  h2{ margin:0 0 6px; font-size:22px; font-weight:800; text-align:center }
  p.lead { text-align:center; margin:0 0 18px; color:var(--muted) }

  label{ display:block; color:#cbd5e1; font-weight:700; margin-bottom:8px; font-size:13px }
  input[type="password"]{
    width:100%; padding:12px 14px; border-radius:10px; border:none; font-size:15px; outline:none;
    background:#fff; color:#071029; margin-bottom:10px;
  }

  .helper{ color:var(--muted); font-size:13px; margin-bottom:12px }

  .btn{
    width:100%; background:linear-gradient(90deg,var(--accent),#03956d); padding:12px; border:none; border-radius:10px; color:#fff; font-weight:800; cursor:pointer;
    box-shadow:0 12px 30px rgba(2,8,20,0.32); position:relative; overflow:hidden; transition:transform .12s ease, box-shadow .12s ease;
  }
  .btn:hover{ transform:translateY(-4px); box-shadow:0 20px 40px rgba(2,8,20,0.38); }
  .btn::after{ content:""; position:absolute; left:-40%; top:0; width:40%; height:100%; background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.18), rgba(255,255,255,0.06)); transform:skewX(-18deg) translateX(-100%); transition:transform .9s ease; }
  .btn:hover::after{ transform: skewX(-18deg) translateX(260%); }

  .links{ text-align:center; margin-top:12px; font-size:14px }
  .links a{ color:var(--muted); text-decoration:none; font-weight:700 }
  .links a:hover{ text-decoration:underline }

  /* toast UI (copied from forgot/login) */
  .toast-wrap{ position:fixed; top:20px; right:20px; display:flex; flex-direction:column; gap:12px; z-index:9999; pointer-events:none; }
  .toast{ pointer-events:auto; min-width:300px; max-width:420px; display:flex; gap:12px; align-items:flex-start; padding:12px 14px; border-radius:12px;
          background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12)); color:#fff; box-shadow:0 12px 32px rgba(0,0,0,0.45);
          transform: translateY(-8px) scale(.98); opacity:0; transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .22s ease; border:1px solid rgba(255,255,255,0.03); }
  .toast.show{ transform: translateY(0) scale(1); opacity:1; }
  .toast .icon{ width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#222; }
  .toast .body{ flex:1; }
  .toast .title{ font-weight:800; margin-bottom:4px; font-size:14px; }
  .toast .msg{ color:var(--muted); font-size:13px; line-height:1.2; }
  .toast .close{ background:transparent; border:none; color:rgba(255,255,255,0.7); font-size:16px; cursor:pointer; margin-left:8px; }
  .toast.error .icon{ background: linear-gradient(180deg,#ffd7d4,#ffb8b0); }
  .toast.success .icon{ background: linear-gradient(180deg,#dff7ea,#b7f0d0); }
  .toast.info .icon{ background: linear-gradient(180deg,#e6f0ff,#cfe3ff); color:#0b3a66; }

  @media (max-width:520px){
    .panel{ width:92%; padding:20px }
    .toast{ right:10px; left:10px; min-width:unset; max-width:calc(100% - 20px); }
  }
</style>
</head>
<body>
  <div class="bg-layer"><img src="/static/images/bacgroung_img.png" alt="bg"></div>
  <div class="grain" aria-hidden="true"></div>

  <div class="panel" role="region" aria-labelledby="reset-title">
    <h2 id="reset-title">Reset your password</h2>
    <p class="lead">Set a new secure password for <strong>{{ email }}</strong></p>

    <!-- POSTs to /reset-password (your route handles update) -->
    <form id="resetForm" action="/reset-password" method="POST" autocomplete="new-password" novalidate>
      <!-- keep email hidden (provided by link in email -> route passed 'email' to template) -->
      <input type="hidden" name="email" value="{{ email }}">

      <label for="password">New password</label>
      <input id="password" name="password" type="password" minlength="8" placeholder="At least 8 characters" required>

      <label for="confirm">Confirm password</label>
      <input id="confirm" name="confirm" type="password" minlength="8" placeholder="Repeat new password" required>

      <div class="helper">Use 8+ characters. Avoid reusing old passwords.</div>

      <button type="submit" class="btn">Update password</button>

      <div class="links">
        <a href="/">← Back to Login</a>
      </div>
    </form>
  </div>

  <!-- toast container -->
  <div id="toastWrap" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

<script>
  // Toast helpers (same behavior as other pages)
  const toastWrap = document.getElementById('toastWrap');
  function makeToast(type, title, message, opts = {}) {
    const id = 't' + Date.now() + Math.floor(Math.random()*1000);
    const el = document.createElement('div');
    el.className = `toast ${type || 'info'}`;
    el.id = id;
    el.innerHTML = `
      <div class="icon">${ type === 'error' ? '!' : type === 'success' ? '✓' : 'i' }</div>
      <div class="body">
        <div class="title">${title}</div>
        <div class="msg">${message}</div>
      </div>
      <button class="close" aria-label="Dismiss">&times;</button>
    `;
    toastWrap.prepend(el);
    requestAnimationFrame(()=> el.classList.add('show'));
    el.querySelector('.close').addEventListener('click', ()=> dismissToast(el));
    const ttl = opts.ttl || parseInt(getComputedStyle(document.documentElement).getPropertyValue('--toast-ttl')) || 5200;
    let timer = setTimeout(()=> dismissToast(el), ttl);
    el.addEventListener('mouseenter', ()=> clearTimeout(timer));
    el.addEventListener('mouseleave', ()=> { timer = setTimeout(()=> dismissToast(el), ttl); });
  }
  function dismissToast(el){
    if(!el) return;
    el.classList.remove('show');
    setTimeout(()=> { try{ el.remove(); }catch(e){} }, 260);
  }

  // client-side validation before submitting
  const form = document.getElementById('resetForm');
  form.addEventListener('submit', function(ev){
    const pwd = document.getElementById('password').value || '';
    const conf = document.getElementById('confirm').value || '';
    // quick checks
    if(pwd.length < 8){
      ev.preventDefault();
      makeToast('error','Password too short','Password must be at least 8 characters long.',{ttl:6000});
      return false;
    }
    if(pwd !== conf){
      ev.preventDefault();
      makeToast('error','Passwords do not match','Please make sure both password fields match.',{ttl:6000});
      return false;
    }
    // allow submit to server (server will hash and update)
  });

  // show any flashed messages from server as toasts
  // NOTE: this template must be rendered by Flask (not served statically)
  const flashed = {{ get_flashed_messages(with_categories=True) | tojson | safe }};
  (function(){
    if(!Array.isArray(flashed) || flashed.length === 0) return;
    flashed.forEach(([category, msg]) => {
      const cat = (category || '').toLowerCase();
      if(cat === 'error') makeToast('error','Error',msg,{ttl:7000});
      else if(cat === 'success') makeToast('success','Success',msg,{ttl:5200});
      else makeToast('info','Info',msg,{ttl:5200});
    });
  })();
</script>
</body>
</html>

